<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
The R Project for Statistical Computing roll installation test.
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<post>

/bin/mkdir -m 0755 /root/rolltests

<file name="/root/rolltests/R.t" perms="0755">
<![CDATA[#!/usr/bin/perl -w

use Test::More qw(no_plan);

my $appliance = $#ARGV >= 0 ? $ARGV[0] :
                -d '/export/rocks/install' ? 'Frontend' : 'Compute';
my $isCompute = $appliance eq 'Compute';
my $isFe = $appliance eq 'Frontend';
my $isLogin = $appliance eq 'Login';
my $output;
my $TESTFILE = 'tmpR';

open(OUT, ">$TESTFILE.R");
print OUT <<END;
x <- c(9, 7, 5, 3, 1, 8, 6, 4, 2, 0)
sort(x)
END
close(OUT);

ok(! $isLogin == -d '/opt/R', 'R is/is not installed');
SKIP: {

  skip 'R roll not installed', 1 if $isLogin;
  $output = `/opt/R/bin/R --vanilla < $TESTFILE.R`;
  like($output, qr/0.*1.*2.*3.*4.*5.*6.*7.*8.*9/, 'Simple R run');

}

`rm -f $TESTFILE*`;
]]>
</file>

</post>

</kickstart> 
